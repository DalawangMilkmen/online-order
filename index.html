<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Online orders - Dalawang Milkmen</title>
    <meta
      property="og:url"
      content="https://dalawangmilkmen.github.io/online-order/"
    />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Online orders - Dalawang Milkmen" />
    <meta
      property="og:description"
      content="You can now enjoy your favorite yogurt delivered right to your doorstep!"
    />
    <meta
      property="og:image"
      content="https://dalawangmilkmen.github.io/online-order/assets/img/dmm/facebook-share.png"
    />

    <meta
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
      name="viewport"
    />
    <meta name="viewport" content="width=device-width" />

    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="assets/img/dmm/dmm-favicon.png"
    />
    <link rel="icon" type="image/png" href="assets/img/dmm/dmm-favicon.png" />

    <!--     Fonts and icons     -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons"
    />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css"
    />

    <!-- CSS Files -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/css/material-bootstrap-wizard.css" rel="stylesheet" />

    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="assets/css/demo.css" rel="stylesheet" />
  </head>

  <body>
    <style media="screen">
      .image-container:before {
        opacity: 0.4 !important;
      }
      .no_margin {
        margin-bottom: 0;
        margin-top: -20px;
        text-align: center;
      }
    </style>
    <div
      class="image-container set-full-height"
      style="background-image: url('assets/img/dmm/background-dmm.jpg');"
    >
      <!--   Creative Tim Branding   -->
      <a href="https://dalawangmilkmen.github.io/" target="_blank">
        <div class="logo-container">
          <div class="">
            <img
              style="height: 80px;"
              src="assets/img/dmm/dmm-logo-outline.png"
            />
          </div>
          <!-- <div class="brand">
	                Dalawang Milkmen
	            </div> -->
        </div>
      </a>

      <!--  Made With Material Kit  -->
      <!-- <a href="http://demos.creative-tim.com/material-kit/index.html?ref=material-bootstrap-wizard" class="made-with-mk">
			<div class="brand">MK</div>
			<div class="made-with">Made with <strong>Material Kit</strong></div>
		</a> -->

      <!--   Big container   -->
      <div class="container">
        <div class="row">
          <div class="col-sm-8 col-sm-offset-2">
            <!--      Wizard container        -->
            <div class="wizard-container">
              <div class="order-confirm" style="text-align: center;">
                <img
                  src="assets/img/dmm/dmm-logo-outline.png"
                  style="height: 200px;"
                  alt=""
                />

                <h2 style="color: #fff;">This is our old ordering system.</h2>
                <h4 style="color: #fff;">
                  You will be automaticaly redirected in a few second
                </h4>
                <br /><br />
                <a
                  class="btn btn-next btn-fill btn-info btn-wd"
                  href="https://dalawangmilkmen.github.io/"
                  >Order Na !!
                </a>
                <div class="display:inline-block">
                  <a
                    href="#"
                    style="color: #4469b0; padding: 10px; font-size: 20px;"
                    target="_blank"
                    ><i class="fa fa-facebook"></i
                  ></a>
                  <a
                    href="https://www.instagram.com/dalawang_milkmen/"
                    style="color: #d35169; padding: 10px; font-size: 20px;"
                    target="_blank"
                    ><i class="fa fa-instagram"></i
                  ></a>
                  <!-- <a href="#" style="color:#fff;padding:10px;font-size: 20px;" target="_blank"><i class="fa fa-envelope"></i></a> -->
                </div>
              </div>
            </div>
            <!-- wizard container -->
          </div>
        </div>
        <!-- row -->
      </div>
      <!--  big container -->

      <div class="footer">
        <!-- <div class="container text-center">
	             Freshly made with <i class="fa fa-heart heart"></i> in Lipa
	        </div> -->
        <div class="container text-center">
          For exceptional orders
          <a href="https://www.messenger.com/t/DalawangMilkmen" target="_blank"
            >contact us.</a
          >
        </div>
      </div>
    </div>
  </body>
  <!--   Core JS Files   -->
  <script src="assets/js/jquery-2.2.4.min.js" type="text/javascript"></script>
  <script src="assets/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="assets/js/jquery.bootstrap.js" type="text/javascript"></script>

  <!--  Plugin for the Wizard -->
  <script src="assets/js/material-bootstrap-wizard.js"></script>

  <!--  More information about jquery.validate here: http://jqueryvalidation.org/	 -->
  <script src="assets/js/jquery.validate.min.js"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function (e) {
      function redirect() {
        document.location.href = "https://dalawangmilkmen.github.io/";
      }

      setTimeout(() => {
        redirect();
      }, 5000);

      if (document.documentMode || /Edge/.test(navigator.userAgent)) {
        alert("Sorry our orders doesn't work on Edge and Internet Explorer");
      }

      // init variables
      var stock;
      var deliveryDate;
      var deliveryPrice;
      var yogourtPrice;
      var mangoPrice;
      var strawberryPrice;
      var raspberryPrice;
      var strawberryPrice;
      var sweetenedPrice;
      var unsweetenedPrice;
      var jarrePrice;
      var mango = "0";
      var raspberry = "0";
      var strawberry = "0";
      var sweetened = "0";
      var unsweetened = "0";
      var jarre = 0;
      var totalProduct;
      var totalPrice;
      // send order
      var send = document.getElementById("send");
      var next = document.getElementById("next");
      var previous = document.getElementById("previous");
      var loading = document.getElementById("loading");
      // Price placeholders
      var mp = document.getElementById("mp");
      var rp = document.getElementById("rp");
      var sp = document.getElementById("sp");
      var swp = document.getElementById("swp");
      var up = document.getElementById("up");
      var deliveryTime = document.getElementById("deliveryTime");
      var district = document.getElementById("district");
      var barangaySelect = document.getElementById("barangay");
      var apiKey = "keyy91JVw4nn9lwqH";
      var baseid = "appWeyp3UlQHHV5By";

      var initStock = function (product) {
        var stock = document.getElementById("stock-" + product.fields.Name);
        // console.log(stock);
        if (product.fields.stock > 15) {
          for (var i = 1; i < 16; i++) {
            this.option = document.createElement("option");
            this.option.innerText = i;
            this.option.value = i;
            stock.append(this.option);
          }
        } else {
          // console.log( product.fields.stock);
          for (var i = 0; i < product.fields.stock; i++) {
            this.option = document.createElement("option");
            this.option.innerText = i + 1;
            this.option.value = i + 1;
            stock.append(this.option);
          }
        }
      };
      var initTime = function (time) {
        this.option = document.createElement("option");
        this.option.innerText = time.fields.horraire;
        deliveryTime.append(this.option);
      };

      var initCities = function (city) {
        this.option = document.createElement("option");
        this.option.innerText = city.fields.Name;
        district.append(this.option);
      };
      var initBarangay = function (barangay) {
        this.option = document.createElement("option");
        this.option.innerText = barangay.fields.Name;
        this.option.setAttribute("value", barangay.fields.DeliveryFees);
        barangaySelect.append(this.option);
      };

      $("#barangay").on("change", function () {
        var optionValue = $(this).val();
        deliveryPrice = optionValue;
        console.log(deliveryPrice);
        calculateTotal();
        $("#summay-deliveryfee").text(deliveryPrice);
      });

      var calculateTotal = function () {
        totalProduct =
          parseFloat(unsweetened) * unsweetenedPrice +
          parseFloat(mango) * mangoPrice +
          parseFloat(raspberry) * raspberryPrice +
          parseFloat(strawberry) * strawberryPrice +
          parseFloat(sweetened) * sweetenedPrice;

        console.log("prix total :", totalProduct);
        console.log(parseFloat(unsweetened) * unsweetenedPrice);
        console.log(parseFloat(mango) * mangoPrice);
        console.log(parseFloat(raspberry) * raspberryPrice);
        console.log(parseFloat(strawberry) * strawberryPrice);
        console.log(parseFloat(sweetened) * sweetenedPrice);
        // if (totalProduct < 7) {
        // 	$('#summay-deliveryfee').text('50');
        // 	$('#deliveryFree').text('ðŸ‘ Order 7 or more yogurts to have a free delivery');
        //
        // 	totalPrice = (totalProduct * yogourtPrice) + parseFloat(deliveryPrice) - (jarre*jarrePrice)
        // }else {
        // $('#summay-deliveryfee').text('free');
        $("#deliveryFree").text("");
        totalPrice = totalProduct - jarre * jarrePrice;
        console.log("total delivery fee", deliveryPrice);
        totalPrice = totalPrice + parseFloat(deliveryPrice);

        // }
        // console.log(totalPrice);
        $("#summay-Price").text(totalPrice);
      };

      $("#stock-Mango").on("change", function () {
        // console.log(this.value);
        mango = this.value;
        $("#summary-Mango").text(" ( x " + this.value + ")");
        $("#smp").text(parseFloat(this.value) * mangoPrice);
        calculateTotal();
      });
      $("#stock-Raspberry").on("change", function () {
        raspberry = this.value;
        $("#summary-Raspberry").text(" ( x " + this.value + ")");
        $("#srp").text(parseFloat(this.value) * raspberryPrice);

        calculateTotal();
      });
      $("#stock-Strawberry").on("change", function () {
        strawberry = this.value;
        $("#summary-Strawberry").text(" ( x " + this.value + ")");
        $("#ssp").text(parseFloat(this.value) * strawberryPrice);
        calculateTotal();
      });
      $("#stock-Unsweetened").on("change", function () {
        unsweetened = this.value;
        $("#summary-Unsweetened").text(" ( x " + this.value + ")");
        $("#sup").text(parseFloat(this.value) * unsweetenedPrice);
        calculateTotal();
      });
      $("#stock-Sweetened").on("change", function () {
        sweetened = this.value;
        $("#summary-Sweetened").text(" ( x " + this.value + ")");
        $("#sswp").text(parseFloat(this.value) * sweetenedPrice);
        calculateTotal();
      });
      $("#jarrenb").on("change", function () {
        jarre = this.value;
        $("#summary-Jarre").text(" ( x " + this.value + ")");
        $("#sjp").text("-" + parseFloat(this.value) * jarrePrice);
        calculateTotal();
      });

      next.addEventListener("click", function (e) {
        if (totalProduct < 240) {
          alert("Sorry, the minimum order is 3 yogurts ");
          e.preventDefault();
          $("#previous").click();
        }
      });

      send.addEventListener("click", function (e) {
        if (totalProduct < 240) {
          alert("Sorry, the minimum order is 3 yogurts ");
        } else {
          send.style.display = "none";
          loading.style.display = "block";
          sendOrder();
        }
      });

      var sendOrder = function () {
        // Customer info

        var firstname = document.querySelectorAll('input[name$="firstname"]')[0]
          .value;
        var lastname = document.querySelectorAll('input[name$="lastname"]')[0]
          .value;
        var email = document.querySelectorAll('input[name$="email"]')[0].value;
        var phone = document.querySelectorAll('input[name$="phone"]')[0].value;

        // Delivery Info

        var deliveryTimeselect = document.getElementById("deliveryTime");
        var deliveryTime =
          deliveryTimeselect.options[deliveryTimeselect.selectedIndex].value;
        var barangayselect = document.getElementById("barangay");
        var barangay =
          barangayselect.options[barangayselect.selectedIndex].text;
        var districtselect = document.getElementById("district");
        var district =
          districtselect.options[districtselect.selectedIndex].value;
        var street = document.querySelectorAll('input[name$="street"]')[0]
          .value;
        var housenb = document.querySelectorAll('input[name$="housenb"]')[0]
          .value;
        var bill = document.querySelectorAll('input[name$="bill"]')[0].value;
        var floor = document.querySelectorAll('input[name$="floor"]')[0].value;

        var order = {
          fields: {
            "First Name": firstname,
            "Total Amount": parseFloat(totalPrice),
            "Last Name": lastname,
            Mango: parseFloat(mango),
            Raspberry: parseFloat(raspberry),
            Sweetened: parseFloat(sweetened),
            Strawberry: parseFloat(strawberry),
            Email: email,
            Phone: phone,
            Unsweetened: parseFloat(unsweetened),
            "Jarre to return": parseFloat(jarre),
            "Delivery Time": deliveryTime,
            District: district,
            Barangay: barangay,
            Street: street,
            "House number": housenb,
            "Delivery Date": deliveryDate,
            "Change for": bill,
            "Floor / Unit / Room#": floor,
            deliveryfee: deliveryPrice,
          },
        };

        console.log(order.fields.Mango);
        SaveOrder(order);
      };

      SaveOrder = (order) => {
        console.log(order.fields.Mango);

        var url = "https://api.airtable.com/v0/" + baseid + "/Customer";

        fetch(url, {
          method: "POST",
          headers: new Headers({
            Authorization: "Bearer " + apiKey,
            "Content-Type": "application/json",
          }),
          body: JSON.stringify(order),
        })
          .then((response) => response.json())
          .then((product) => {
            console.log(product);
            console.log(product.fields.Mango);

            if (product.fields.Mango > 0) {
              UdpateStock(stock[0], product.fields.Mango);
            }
            if (product.fields.Strawberry > 0) {
              UdpateStock(stock[1], product.fields.Strawberry);
            }
            if (product.fields.Raspberry > 0) {
              UdpateStock(stock[2], product.fields.Raspberry);
            }
            if (product.fields.Sweetened > 0) {
              UdpateStock(stock[3], product.fields.Sweetened);
            }
            if (product.fields.Unsweetened > 0) {
              UdpateStock(stock[4], product.fields.Unsweetened);
            }

            setTimeout(function () {
              document.getElementsByClassName("wizard-card")[0].style.display =
                "none";
              document.getElementsByClassName("footer")[0].style.display =
                "none";
              document.getElementsByClassName(
                "order-confirm"
              )[0].style.display = "block";
            }, 1000);
          })
          .catch((error) => {
            console.error(error);
          });
      };

      UdpateStock = (yogourt, amount) => {
        yogourt.fields.stock = yogourt.fields.stock - amount;

        var url =
          "https://api.airtable.com/v0/" + baseid + "/Stock/" + yogourt.id;
        console.log(yogourt);
        console.log(yogourt.fields);
        console.log(url);

        var yogourtUpdate = {
          fields: yogourt.fields,
        };

        fetch(url, {
          method: "PUT",
          headers: new Headers({
            Authorization: "Bearer " + apiKey,
            "Content-Type": "application/json",
          }),
          body: JSON.stringify(yogourtUpdate),
        })
          .then((response) => response.json())
          .then((product) => {
            console.log(product);
          })
          .catch((error) => {
            console.error(error);
          });
      };

      fetchProduct = () => {
        let url =
          "https://api.airtable.com/v0/" +
          baseid +
          "/Stock?maxRecords=10&view=Grid%20view";

        fetch(url, {
          method: "get",
          headers: new Headers({
            Authorization: "Bearer " + apiKey,
          }),
        })
          .then((response) => response.json())
          .then((product) => {
            // console.log(product.records)
            stock = product.records;
            console.log(stock);

            for (var i = 0; i < stock.length; i++) {
              initStock(stock[i]);
            }
          })
          .catch((error) => {
            console.error(error);
          });
      };

      fetchDeliveryTime = () => {
        let url =
          "https://api.airtable.com/v0/" +
          baseid +
          "/horraire?maxRecords=10&view=Grid%20view";

        fetch(url, {
          method: "get",
          headers: new Headers({
            Authorization: "Bearer " + apiKey,
          }),
        })
          .then((response) => response.json())
          .then((times) => {
            // console.log(product.records)
            times = times.records;
            console.log(times);

            for (var i = 0; i < times.length; i++) {
              initTime(times[i]);
            }
          })
          .catch((error) => {
            console.error(error);
          });
      };
      fetchCities = () => {
        let url =
          "https://api.airtable.com/v0/" +
          baseid +
          "/cities?maxRecords=10&view=Grid%20view";

        fetch(url, {
          method: "get",
          headers: new Headers({
            Authorization: "Bearer " + apiKey,
          }),
        })
          .then((response) => response.json())
          .then((cities) => {
            cities = cities.records;
            console.log(cities);

            for (var i = 0; i < cities.length; i++) {
              initCities(cities[i]);
            }
          })
          .catch((error) => {
            console.error(error);
          });
      };
      fetchBarangay = () => {
        let url =
          "https://api.airtable.com/v0/" +
          baseid +
          "/barangay?maxRecords=200&view=Grid%20view";

        fetch(url, {
          method: "get",
          headers: new Headers({
            Authorization: "Bearer " + apiKey,
          }),
        })
          .then((response) => response.json())
          .then((barangay) => {
            barangay = barangay.records;
            console.log(barangay);

            for (var i = 0; i < barangay.length; i++) {
              initBarangay(barangay[i]);
            }
          })
          .catch((error) => {
            console.error(error);
          });
      };
      fetchInfo = () => {
        let url =
          "https://api.airtable.com/v0/" +
          baseid +
          "/Info?maxRecords=10&view=Grid%20view";

        fetch(url, {
          method: "get",
          headers: new Headers({
            Authorization: "Bearer " + apiKey,
          }),
        })
          .then((response) => response.json())
          .then((delivery) => {
            console.log(delivery.records);
            // console.log(delivery.records[0].fields.Date);
            document.getElementById("nextDelivery").innerText =
              delivery.records[0].fields.info;
            document.getElementById("tagline").innerHTML =
              "<br>" + delivery.records[9].fields.info;
            document.getElementById("datedelivery").innerText =
              delivery.records[0].fields.info;
            deliveryDate = delivery.records[0].fields.info;
            yogourtPrice = delivery.records[1].fields.info;
            jarrePrice = delivery.records[2].fields.info;
            deliveryPrice = delivery.records[3].fields.info;
            mangoPrice = delivery.records[4].fields.info;
            strawberryPrice = delivery.records[5].fields.info;
            raspberryPrice = delivery.records[6].fields.info;
            sweetenedPrice = delivery.records[7].fields.info;
            unsweetenedPrice = delivery.records[8].fields.info;

            mp.innerText = mangoPrice;
            rp.innerText = raspberryPrice;
            sp.innerText = strawberryPrice;
            swp.innerText = sweetenedPrice;
            up.innerText = unsweetenedPrice;
            // console.log(unsweetenedPrice ,raspberryPrice, mangoPrice);
            // localStorage.setItem('areas', JSON.stringify(product.records));

            // for (var i = 0; i < stock.length; i++) {
            // 	initStock(stock[i]);
            // }
          })
          .catch((error) => {
            console.error(error);
          });
      };
    });
  </script>
</html>
